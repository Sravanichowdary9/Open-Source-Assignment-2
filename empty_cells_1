#!/bin/bash

# Script: empty_cells
# Description: Counts empty cells in each column of a spreadsheet-like text file
# Usage: ./empty_cells <input_file> <separator_character>

# Check if correct number of arguments are provided
if [ $# -ne 2 ]; then
    echo "Usage: $0 <input_file> <separator_character>"
    exit 1
fi

input_file="$1"
separator="$2"

# Check if the input file exists
if [ ! -f "$input_file" ]; then
    echo "Error: Input file '$input_file' does not exist."
    exit 1
fi

# Process the file using awk for more efficient processing
awk -F"$separator" '
BEGIN {
    # Initialize variables
    header_processed = 0
}
{
    # Process header line
    if (header_processed == 0) {
        # Store column titles
        for (i = 1; i <= NF; i++) {
            # Remove quotes if present
            gsub(/^"|"$/, "", $i)
            columns[i] = $i
            empty_counts[i] = 0
        }
        num_columns = NF
        header_processed = 1
        next
    }
    
    # Process data lines
    for (i = 1; i <= num_columns; i++) {
        # Check if field is empty
        if ($i == "" || $i == "\"\"") {
            empty_counts[i]++
        }
    }
}
END {
    # Output results
    for (i = 1; i <= num_columns; i++) {
        print columns[i] ": " empty_counts[i]
    }
}' "$input_file"
